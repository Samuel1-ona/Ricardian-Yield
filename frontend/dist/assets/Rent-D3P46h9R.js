var je=Object.defineProperty;var ve=(t,e,r)=>e in t?je(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var b=(t,e,r)=>ve(t,typeof e!="symbol"?e+"":e,r);import{d as ke,c as Ne,t as Ee,p as Be,g as X,e as J,i as P,l as Q,m as ie,j as n}from"./web3-vendor-Ds0lPK1P.js";import{r as x}from"./react-vendor-CIGKTyFs.js";import{C as M,d as R,a as L,b as O,c as V}from"./Card-BfqoSBQt.js";import{u as te,p as Ue,S as $e,a as Ae,b as De,c as Pe,B as U,d as Ie}from"./index-B769BxWL.js";import{z as m}from"./ui-vendor-BDTlLGxs.js";import{p as Me,i as Re,j as Te,k as _e,E as G,X as ae,D as Fe,u as Le,b as Oe}from"./useStacksRead-DDPqlTuW.js";import{a as Ve}from"./useStacksWriteWallet-BxURRJTD.js";import"./charts-vendor-D_nd7r1X.js";const He=ke({id:11155111,name:"Sepolia",nativeCurrency:{name:"Sepolia Ether",symbol:"ETH",decimals:18},rpcUrls:{default:{http:["https://11155111.rpc.thirdweb.com"]}},blockExplorers:{default:{name:"Etherscan",url:"https://sepolia.etherscan.io",apiUrl:"https://api-sepolia.etherscan.io/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:751532},ensUniversalResolver:{address:"0xeeeeeeee14d718c2b47d9923deab1335e144eeee",blockCreated:8928790}},testnet:!0}),ze=$e;function We(){const{address:t}=te(),{data:e,isLoading:r,error:s}=Ne({queryKey:["usdcx-balance",t||""],queryFn:async()=>{if(!t)return null;const i=Re("testnet"),{address:a,contractName:o}=Me(i),l=await Te({contractAddress:a,contractName:o,functionName:"get-balance",functionArgs:[Ue(t)],network:ze,senderAddress:t}),c=_e(l);return c.value?BigInt(c.value):BigInt(0)},enabled:!!t,staleTime:10*1e3,refetchInterval:30*1e3});return{balance:e,isLoading:r,error:s,formatted:e?(Number(e)/1e6).toFixed(6):"0.000000"}}/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function ue(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function qe(t){if(!ue(t))throw new Error("Uint8Array expected")}function fe(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function Ye(t){if(typeof t!="function")throw new Error("function expected");return!0}function z(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function pe(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function ee(t){if(!Array.isArray(t))throw new Error("array expected")}function me(t,e){if(!fe(!0,e))throw new Error(`${t}: array of strings expected`)}function Ke(t,e){if(!fe(!1,e))throw new Error(`${t}: array of numbers expected`)}function Xe(...t){const e=a=>a,r=(a,o)=>l=>a(o(l)),s=t.map(a=>a.encode).reduceRight(r,e),i=t.map(a=>a.decode).reduce(r,e);return{encode:s,decode:i}}function Je(t){const e=typeof t=="string"?t.split(""):t,r=e.length;me("alphabet",e);const s=new Map(e.map((i,a)=>[i,a]));return{encode:i=>(ee(i),i.map(a=>{if(!Number.isSafeInteger(a)||a<0||a>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${a}". Allowed: ${t}`);return e[a]})),decode:i=>(ee(i),i.map(a=>{z("alphabet.decode",a);const o=s.get(a);if(o===void 0)throw new Error(`Unknown letter: "${a}". Allowed: ${t}`);return o}))}}function Qe(t=""){return z("join",t),{encode:e=>(me("join.decode",e),e.join(t)),decode:e=>(z("join.decode",e),e.split(t))}}function Ge(t){return Ye(t),{encode:e=>e,decode:e=>t(e)}}const we=(t,e)=>e===0?t:we(e,t%e),W=(t,e)=>t+(e-we(t,e)),Z=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function oe(t,e,r,s){if(ee(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(W(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${W(e,r)}`);let i=0,a=0;const o=Z[e],l=Z[r]-1,c=[];for(const u of t){if(pe(u),u>=o)throw new Error(`convertRadix2: invalid data word=${u} from=${e}`);if(i=i<<e|u,a+e>32)throw new Error(`convertRadix2: carry overflow pos=${a} from=${e}`);for(a+=e;a>=r;a-=r)c.push((i>>a-r&l)>>>0);const f=Z[a];if(f===void 0)throw new Error("invalid carry");i&=f-1}if(i=i<<r-a&l,!s&&a>=e)throw new Error("Excess padding");if(!s&&i>0)throw new Error(`Non-zero padding: ${i}`);return s&&a>0&&c.push(i>>>0),c}function Ze(t,e=!1){if(pe(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(W(8,t)>32||W(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!ue(r))throw new Error("radix2.encode input should be Uint8Array");return oe(Array.from(r),8,t,!e)},decode:r=>(Ke("radix2.decode",r),Uint8Array.from(oe(r,t,8,e)))}}const et=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",tt={encode(t){return qe(t),t.toHex()},decode(t){return z("hex",t),Uint8Array.fromHex(t)}},T=et?tt:Xe(Ze(4),Je("0123456789abcdef"),Qe(""),Ge(t=>{if(typeof t!="string"||t.length%2!==0)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()}));function rt(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function q(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}const xe=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function be(t){return Object.prototype.toString.call(t)==="[object Object]"}function _(t){return Number.isSafeInteger(t)}const st=t=>{if(t!==null&&typeof t!="string"&&!H(t)&&!q(t)&&!_(t))throw new Error(`lengthCoder: expected null | number | Uint8Array | CoderType, got ${t} (${typeof t})`);return{encodeStream(e,r){if(t===null)return;if(H(t))return t.encodeStream(e,r);let s;if(typeof t=="number"?s=t:typeof t=="string"&&(s=D.resolve(e.stack,t)),typeof s=="bigint"&&(s=Number(s)),s===void 0||s!==r)throw e.err(`Wrong length: ${s} len=${t} exp=${r} (${typeof r})`)},decodeStream(e){let r;if(H(t)?r=Number(t.decodeStream(e)):typeof t=="number"?r=t:typeof t=="string"&&(r=D.resolve(e.stack,t)),typeof r=="bigint"&&(r=Number(r)),typeof r!="number")throw e.err(`Wrong length: ${r}`);return r}}},y={BITS:32,FULL_MASK:-1>>>0,len:t=>Math.ceil(t/32),create:t=>new Uint32Array(y.len(t)),clean:t=>t.fill(0),debug:t=>Array.from(t).map(e=>(e>>>0).toString(2).padStart(32,"0")),checkLen:(t,e)=>{if(y.len(e)!==t.length)throw new Error(`wrong length=${t.length}. Expected: ${y.len(e)}`)},chunkLen:(t,e,r)=>{if(e<0)throw new Error(`wrong pos=${e}`);if(e+r>t)throw new Error(`wrong range=${e}/${r} of ${t}`)},set:(t,e,r,s=!0)=>!s&&t[e]&r?!1:(t[e]|=r,!0),pos:(t,e)=>({chunk:Math.floor((t+e)/32),mask:1<<32-(t+e)%32-1}),indices:(t,e,r=!1)=>{y.checkLen(t,e);const{FULL_MASK:s,BITS:i}=y,a=i-e%i,o=a?s>>>a<<a:s,l=[];for(let c=0;c<t.length;c++){let u=t[c];if(r&&(u=~u),c===t.length-1&&(u&=o),u!==0)for(let f=0;f<i;f++){const h=1<<i-f-1;u&h&&l.push(c*i+f)}}return l},range:t=>{const e=[];let r;for(const s of t)r===void 0||s!==r.pos+r.length?e.push(r={pos:s,length:1}):r.length+=1;return e},rangeDebug:(t,e,r=!1)=>`[${y.range(y.indices(t,e,r)).map(s=>`(${s.pos}/${s.length})`).join(", ")}]`,setRange:(t,e,r,s,i=!0)=>{y.chunkLen(e,r,s);const{FULL_MASK:a,BITS:o}=y,l=r%o?Math.floor(r/o):void 0,c=r+s,u=c%o?Math.floor(c/o):void 0;if(l!==void 0&&l===u)return y.set(t,l,a>>>o-s<<o-s-r,i);if(l!==void 0&&!y.set(t,l,a>>>r%o,i))return!1;const f=l!==void 0?l+1:r/o,h=u!==void 0?u:c/o;for(let g=f;g<h;g++)if(!y.set(t,g,a,i))return!1;return!(u!==void 0&&l!==u&&!y.set(t,u,a<<o-c%o,i))}},D={pushObj:(t,e,r)=>{const s={obj:e};t.push(s),r((i,a)=>{s.field=i,a(),s.field=void 0}),t.pop()},path:t=>{const e=[];for(const r of t)r.field!==void 0&&e.push(r.field);return e.join("/")},err:(t,e,r)=>{const s=new Error(`${t}(${D.path(e)}): ${typeof r=="string"?r:r.message}`);return r instanceof Error&&r.stack&&(s.stack=r.stack),s},resolve:(t,e)=>{const r=e.split("/"),s=t.map(o=>o.obj);let i=0;for(;i<r.length&&r[i]==="..";i++)s.pop();let a=s.pop();for(;i<r.length;i++){if(!a||a[r[i]]===void 0)return;a=a[r[i]]}return a}};class re{constructor(e,r={},s=[],i=void 0,a=0){b(this,"pos",0);b(this,"data");b(this,"opts");b(this,"stack");b(this,"parent");b(this,"parentOffset");b(this,"bitBuf",0);b(this,"bitPos",0);b(this,"bs");b(this,"view");this.data=e,this.opts=r,this.stack=s,this.parent=i,this.parentOffset=a,this.view=xe(e)}_enablePointers(){if(this.parent)return this.parent._enablePointers();this.bs||(this.bs=y.create(this.data.length),y.setRange(this.bs,this.data.length,0,this.pos,this.opts.allowMultipleReads))}markBytesBS(e,r){return this.parent?this.parent.markBytesBS(this.parentOffset+e,r):!r||!this.bs?!0:y.setRange(this.bs,this.data.length,e,r,!1)}markBytes(e){const r=this.pos;this.pos+=e;const s=this.markBytesBS(r,e);if(!this.opts.allowMultipleReads&&!s)throw this.err(`multiple read pos=${this.pos} len=${e}`);return s}pushObj(e,r){return D.pushObj(this.stack,e,r)}readView(e,r){if(!Number.isFinite(e))throw this.err(`readView: wrong length=${e}`);if(this.pos+e>this.data.length)throw this.err("readView: Unexpected end of buffer");const s=r(this.view,this.pos);return this.markBytes(e),s}absBytes(e){if(e>this.data.length)throw new Error("Unexpected end of buffer");return this.data.subarray(e)}finish(){if(!this.opts.allowUnreadBytes){if(this.bitPos)throw this.err(`${this.bitPos} bits left after unpack: ${T.encode(this.data.slice(this.pos))}`);if(this.bs&&!this.parent){const e=y.indices(this.bs,this.data.length,!0);if(e.length){const r=y.range(e).map(({pos:s,length:i})=>`(${s}/${i})[${T.encode(this.data.subarray(s,s+i))}]`).join(", ");throw this.err(`unread byte ranges: ${r} (total=${this.data.length})`)}else return}if(!this.isEnd())throw this.err(`${this.leftBytes} bytes ${this.bitPos} bits left after unpack: ${T.encode(this.data.slice(this.pos))}`)}}err(e){return D.err("Reader",this.stack,e)}offsetReader(e){if(e>this.data.length)throw this.err("offsetReader: Unexpected end of buffer");return new re(this.absBytes(e),this.opts,this.stack,this,e)}bytes(e,r=!1){if(this.bitPos)throw this.err("readBytes: bitPos not empty");if(!Number.isFinite(e))throw this.err(`readBytes: wrong length=${e}`);if(this.pos+e>this.data.length)throw this.err("readBytes: Unexpected end of buffer");const s=this.data.subarray(this.pos,this.pos+e);return r||this.markBytes(e),s}byte(e=!1){if(this.bitPos)throw this.err("readByte: bitPos not empty");if(this.pos+1>this.data.length)throw this.err("readBytes: Unexpected end of buffer");const r=this.data[this.pos];return e||this.markBytes(1),r}get leftBytes(){return this.data.length-this.pos}get totalBytes(){return this.data.length}isEnd(){return this.pos>=this.data.length&&!this.bitPos}bits(e){if(e>32)throw this.err("BitReader: cannot read more than 32 bits in single call");let r=0;for(;e;){this.bitPos||(this.bitBuf=this.byte(),this.bitPos=8);const s=Math.min(e,this.bitPos);this.bitPos-=s,r=r<<s|this.bitBuf>>this.bitPos&2**s-1,this.bitBuf&=2**this.bitPos-1,e-=s}return r>>>0}find(e,r=this.pos){if(!q(e))throw this.err(`find: needle is not bytes! ${e}`);if(this.bitPos)throw this.err("findByte: bitPos not empty");if(!e.length)throw this.err("find: needle is empty");for(let s=r;(s=this.data.indexOf(e[0],s))!==-1;s++){if(s===-1||this.data.length-s<e.length)return;if(rt(e,this.data.subarray(s,s+e.length)))return s}}}class nt{constructor(e=[]){b(this,"pos",0);b(this,"stack");b(this,"buffers",[]);b(this,"ptrs",[]);b(this,"bitBuf",0);b(this,"bitPos",0);b(this,"viewBuf",new Uint8Array(8));b(this,"view");b(this,"finished",!1);this.stack=e,this.view=xe(this.viewBuf)}pushObj(e,r){return D.pushObj(this.stack,e,r)}writeView(e,r){if(this.finished)throw this.err("buffer: finished");if(!_(e)||e>8)throw new Error(`wrong writeView length=${e}`);r(this.view),this.bytes(this.viewBuf.slice(0,e)),this.viewBuf.fill(0)}err(e){if(this.finished)throw this.err("buffer: finished");return D.err("Reader",this.stack,e)}bytes(e){if(this.finished)throw this.err("buffer: finished");if(this.bitPos)throw this.err("writeBytes: ends with non-empty bit buffer");this.buffers.push(e),this.pos+=e.length}byte(e){if(this.finished)throw this.err("buffer: finished");if(this.bitPos)throw this.err("writeByte: ends with non-empty bit buffer");this.buffers.push(new Uint8Array([e])),this.pos++}finish(e=!0){if(this.finished)throw this.err("buffer: finished");if(this.bitPos)throw this.err("buffer: ends with non-empty bit buffer");const r=this.buffers.concat(this.ptrs.map(a=>a.buffer)),s=r.map(a=>a.length).reduce((a,o)=>a+o,0),i=new Uint8Array(s);for(let a=0,o=0;a<r.length;a++){const l=r[a];i.set(l,o),o+=l.length}for(let a=this.pos,o=0;o<this.ptrs.length;o++){const l=this.ptrs[o];i.set(l.ptr.encode(a),l.pos),a+=l.buffer.length}if(e){this.buffers=[];for(const a of this.ptrs)a.buffer.fill(0);this.ptrs=[],this.finished=!0,this.bitBuf=0}return i}bits(e,r){if(r>32)throw this.err("writeBits: cannot write more than 32 bits in single call");if(e>=2**r)throw this.err(`writeBits: value (${e}) >= 2**bits (${r})`);for(;r;){const s=Math.min(r,8-this.bitPos);this.bitBuf=this.bitBuf<<s|e>>r-s,this.bitPos+=s,r-=s,e&=2**r-1,this.bitPos===8&&(this.bitPos=0,this.buffers.push(new Uint8Array([this.bitBuf])),this.pos++)}}}const ce=t=>Uint8Array.from(t).reverse();function ge(t){return{encodeStream:t.encodeStream,decodeStream:t.decodeStream,size:t.size,encode:e=>{const r=new nt;return t.encodeStream(r,e),r.finish()},decode:(e,r={})=>{const s=new re(e,r),i=t.decodeStream(s);return s.finish(),i}}}function it(t,e){if(!H(t))throw new Error(`validate: invalid inner value ${t}`);if(typeof e!="function")throw new Error("validate: fn should be function");return ge({size:t.size,encodeStream:(r,s)=>{let i;try{i=e(s)}catch(a){throw r.err(a)}t.encodeStream(r,i)},decodeStream:r=>{const s=t.decodeStream(r);try{return e(s)}catch(i){throw r.err(i)}}})}const se=t=>{const e=ge(t);return t.validate?it(e,t.validate):e},at=t=>be(t)&&typeof t.decode=="function"&&typeof t.encode=="function";function H(t){return be(t)&&at(t)&&typeof t.encodeStream=="function"&&typeof t.decodeStream=="function"&&(t.size===void 0||_(t.size))}const ot=(t,e)=>se({size:t,encodeStream:(r,s)=>r.writeView(t,i=>e.write(i,s)),decodeStream:r=>r.readView(t,e.read),validate:r=>{if(typeof r!="number")throw new Error(`viewCoder: expected number, got ${typeof r}`);return e.validate&&e.validate(r),r}}),ct=(t,e,r)=>{const s=t*8,i=2**(s-1),a=c=>{if(!_(c))throw new Error(`sintView: value is not safe integer: ${c}`);if(c<-i||c>=i)throw new Error(`sintView: value out of bounds. Expected ${-i} <= ${c} < ${i}`)},o=2**s,l=c=>{if(!_(c))throw new Error(`uintView: value is not safe integer: ${c}`);if(0>c||c>=o)throw new Error(`uintView: value out of bounds. Expected 0 <= ${c} < ${o}`)};return ot(t,{write:r.write,read:r.read,validate:e?a:l})},de=ct(1,!1,{read:(t,e)=>t.getUint8(e),write:(t,e)=>t.setUint8(0,e)}),F=(t,e=!1)=>{if(typeof e!="boolean")throw new Error(`bytes/le: expected boolean, got ${typeof e}`);const r=st(t),s=q(t);return se({size:typeof t=="number"?t:void 0,encodeStream:(i,a)=>{s||r.encodeStream(i,a.length),i.bytes(e?ce(a):a),s&&i.bytes(t)},decodeStream:i=>{let a;if(s){const o=i.find(t);if(!o)throw i.err("bytes: cannot find terminator");a=i.bytes(o-i.pos),i.bytes(t.length)}else a=i.bytes(t===null?i.leftBytes:r.decodeStream(i));return e?ce(a):a},validate:i=>{if(!q(i))throw new Error(`bytes: invalid value ${i}`);return i}})},dt=se({encodeStream(t,e){const r=Pe(e);F(11).encodeStream(t,new Uint8Array(11).fill(0)),de.encodeStream(t,r.version),F(20).encodeStream(t,T.decode(r.hash160))},decodeStream(t){F(11).decodeStream(t);const e=de.decodeStream(t),r=F(20).decodeStream(t);return Ae({hash160:T.encode(r),version:e,type:De.Address})}});function lt(t){return Ee(Be(t,{size:32}))}function ht(t){return lt(dt.encode(t))}const le=11155111;function ye(t="testnet"){const[e,r]=x.useState(null),[s,i]=x.useState(!0),[a,o]=x.useState(null),[l,c]=x.useState(null),[u,f]=x.useState(null),h=t==="testnet"?He:void 0,g=x.useCallback(async d=>{try{const p=await d.request({method:"eth_chainId"});return p?parseInt(p,16):null}catch(p){return console.error("Error getting chain ID:",p),null}},[]),A=x.useCallback(async()=>{const d=typeof window<"u"&&window.ethereum?window.ethereum:void 0;if(!d)throw new Error("MetaMask is not installed");try{await d.request({method:"wallet_switchEthereumChain",params:[{chainId:`0x${le.toString(16)}`}]}),m.success("Switched to Sepolia testnet")}catch(p){if(p.code===4902)try{await d.request({method:"wallet_addEthereumChain",params:[{chainId:`0x${le.toString(16)}`,chainName:"Sepolia",nativeCurrency:{name:"ETH",symbol:"ETH",decimals:18},rpcUrls:["https://ethereum-sepolia.publicnode.com"],blockExplorerUrls:["https://sepolia.etherscan.io"]}]}),m.success("Sepolia testnet added and switched")}catch(j){throw m.error("Failed to add Sepolia network"),j}else throw m.error("Failed to switch network"),p}},[]);x.useEffect(()=>{const d=typeof window<"u"&&window.ethereum?window.ethereum:void 0;if(!d){i(!1);return}(async()=>{try{const S=await d.request({method:"eth_accounts"}),C=await g(d);if(f(C),S.length>0){const B=X(S[0]);r({address:B});const w=J({account:B,chain:h,transport:P(d)}),v=Q({chain:h,transport:P(d)});o(w),c(v)}}catch(S){console.error("Error checking Ethereum connection:",S)}finally{i(!1)}})();const j=S=>{if(S.length===0)r(null),o(null),c(null);else{const C=X(S[0]);r({address:C});const B=J({account:C,chain:h,transport:P(d)}),w=Q({chain:h,transport:P(d)});o(B),c(w)}},k=async S=>{const C=parseInt(S,16);f(C),window.location.reload()};return d.on("accountsChanged",j),d.on("chainChanged",k),()=>{d.removeListener("accountsChanged",j),d.removeListener("chainChanged",k)}},[h,g]);const N=x.useCallback(async()=>{const d=typeof window<"u"&&window.ethereum?window.ethereum:void 0;if(!d)throw m.error("MetaMask is not installed. Please install MetaMask to continue."),new Error("MetaMask not installed");try{const p=await g(d);f(p);const j=await d.request({method:"eth_requestAccounts"});if(j.length===0)throw new Error("No accounts found");const k=X(j[0]);r({address:k});const S=J({account:k,chain:h,transport:P(d)}),C=Q({chain:h,transport:P(d)});o(S),c(C),m.success("MetaMask connected!")}catch(p){throw p.code===4001?m.error("Please connect to MetaMask"):m.error((p==null?void 0:p.message)||"Failed to connect MetaMask"),p}},[h,g]),$=x.useCallback(()=>{r(null),o(null),c(null)},[]);return{account:e,isConnected:!!e,isLoading:s,connect:N,disconnect:$,address:(e==null?void 0:e.address)||null,walletClient:a,publicClient:l,chainId:u,switchToSepolia:A}}const ut=[{name:"depositToRemote",type:"function",stateMutability:"nonpayable",inputs:[{name:"value",type:"uint256"},{name:"remoteDomain",type:"uint32"},{name:"remoteRecipient",type:"bytes32"},{name:"localToken",type:"address"},{name:"maxFee",type:"uint256"},{name:"hookData",type:"bytes"}],outputs:[]}],he=[{name:"approve",type:"function",stateMutability:"nonpayable",inputs:[{name:"spender",type:"address"},{name:"amount",type:"uint256"}],outputs:[{name:"success",type:"bool"}]},{name:"balanceOf",type:"function",stateMutability:"view",inputs:[{name:"account",type:"address"}],outputs:[{name:"balance",type:"uint256"}]}];function ft(t={}){const{network:e="testnet"}=t,{walletClient:r,publicClient:s,address:i,isConnected:a,connect:o,chainId:l,switchToSepolia:c}=ye(e),[u,f]=x.useState(!1),[h,g]=x.useState(!1),[A,N]=x.useState(!1),[$,d]=x.useState(null),p=11155111,j=async(k,S)=>{var C,B;if(!a||!r||!s||!i){const w=new Error("Please connect your MetaMask wallet");d(w),m.error(w.message);try{await o()}catch{}throw w}if(e==="testnet"&&l!==p){const w=new Error("Please switch to Sepolia testnet");d(w),m.error("You must be on Sepolia testnet. Switching now...",{duration:3e3});try{return await c(),await new Promise(v=>setTimeout(v,1e3)),j(k,S)}catch{throw m.error("Failed to switch network. Please switch to Sepolia manually in MetaMask."),w}}f(!0),d(null);try{if(await s.getBalance({address:i})===0n)throw new Error("Insufficient native ETH balance for gas fees");const v=ie(k,6),E=ie("0",6),I=ht(S),Se="0x";let Y;try{Y=await s.readContract({address:G[e],abi:he,functionName:"balanceOf",args:[i]})}catch(K){throw(C=K.message)!=null&&C.includes("returned no data")||(B=K.message)!=null&&B.includes("0x")?new Error(`Failed to read USDC balance. Make sure you're on ${e==="testnet"?"Sepolia testnet":"Ethereum mainnet"} and the contract exists at this address.`):K}if(Y<v)throw new Error(`Insufficient USDC balance. Required: ${k} USDC, Have: ${Number(Y)/1e6} USDC`);g(!0),m.loading("Approving xReserve to spend USDC...",{id:"approve"});const Ce=await r.writeContract({address:G[e],abi:he,functionName:"approve",args:[ae[e],v],chain:r.chain||void 0});await s.waitForTransactionReceipt({hash:Ce}),m.success("Approval confirmed",{id:"approve"}),g(!1),N(!0),m.loading("Initiating bridge deposit to Stacks...",{id:"deposit"});const ne=await r.writeContract({address:ae[e],abi:ut,functionName:"depositToRemote",args:[v,Fe.STACKS,I,G[e],E,Se],chain:r.chain||void 0});return await s.waitForTransactionReceipt({hash:ne}),m.success("Bridge deposit initiated! USDCx will be minted on Stacks in ~15 minutes.",{id:"deposit"}),N(!1),f(!1),ne}catch(w){const v=w instanceof Error?w:new Error((w==null?void 0:w.message)||"Bridge failed");throw d(v),m.error(v.message),f(!1),g(!1),N(!1),v}};return{bridgeUSDC:j,isPending:u,isApproving:h,isDepositing:A,error:$}}function pt({onBridged:t,inline:e=!1}){const{address:r}=te(),{address:s,isConnected:i,connect:a,isLoading:o,chainId:l,switchToSepolia:c}=ye("testnet"),[u,f]=x.useState(""),[h,g]=x.useState(r||""),[A,N]=x.useState(!1),d=l===11155111,{bridgeUSDC:p,isPending:j,isApproving:k,isDepositing:S}=ft({network:"testnet"});x.useEffect(()=>{r&&!h&&g(r)},[r,h]);const C=E=>{if(!E)return!1;const I=E.trim();return(I.startsWith("ST")||I.startsWith("SP"))&&I.length>=39},B=async()=>{if(!h||!h.trim()){m.error("Please enter a Stacks recipient address");return}if(!C(h)){m.error("Please enter a valid Stacks address (starts with ST or SP)");return}if(!i||!s){m.error("Please connect your MetaMask wallet");try{await a()}catch{}return}if(!u||parseFloat(u)<=0){m.error("Please enter a valid amount");return}if(parseFloat(u)<1){m.error("Minimum amount is 1 USDC on testnet");return}try{await p(u,h.trim()),f(""),t==null||t()}catch(E){console.error("Bridge error:",E)}};if(!A)return e?n.jsx("div",{className:"border-2 border-dashed border-primary/30 rounded-lg p-4 bg-primary/5",children:n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"You need USDCx on Stacks to deposit rent. Bridge USDC from Ethereum to get started."}),n.jsx(U,{variant:"outline",onClick:()=>N(!0),children:"Bridge USDC → USDCx"})]})}):n.jsx(M,{className:"border-2 border-dashed border-primary/30 w-full",children:n.jsx(R,{className:"pt-6",children:n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"You need USDCx on Stacks to deposit rent. Bridge USDC from Ethereum to get started."}),n.jsx(U,{variant:"outline",onClick:()=>N(!0),children:"Bridge USDC → USDCx"})]})})});const w=typeof window<"u"&&window.ethereum&&window.ethereum.isMetaMask,v=n.jsxs("div",{className:"space-y-4 overflow-hidden",children:[!w&&n.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:n.jsxs("p",{className:"text-xs text-yellow-800 break-words",children:[n.jsx("strong",{children:"MetaMask Required:"})," Please install MetaMask browser extension to bridge USDC.",n.jsx("a",{href:"https://metamask.io/download/",target:"_blank",rel:"noopener noreferrer",className:"ml-1 text-yellow-900 underline",children:"Download MetaMask"})]})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ethereum Wallet (MetaMask)"}),i&&s?n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg min-w-0",children:[n.jsxs("div",{className:"min-w-0 flex-1 mr-2",children:[n.jsx("p",{className:"text-sm font-medium text-green-800",children:"Connected"}),n.jsx("p",{className:"text-xs text-green-600 truncate",children:Ie(s)})]}),n.jsx(U,{variant:"outline",size:"sm",onClick:()=>{window.location.reload()},className:"flex-shrink-0",children:"Disconnect"})]}),l&&n.jsx("div",{className:`p-3 rounded-lg border min-w-0 ${d?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"}`,children:n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("div",{className:"min-w-0 flex-1",children:[n.jsxs("p",{className:`text-sm font-medium ${d?"text-green-800":"text-yellow-800"}`,children:["Network: ",d?"Sepolia Testnet":`Chain ID ${l}`]}),!d&&n.jsx("p",{className:"text-xs text-yellow-600 mt-1",children:"You must be on Sepolia testnet to bridge"})]}),!d&&n.jsx(U,{variant:"outline",size:"sm",onClick:c,className:"flex-shrink-0",children:"Switch to Sepolia"})]})})]}):n.jsx(U,{variant:"outline",onClick:a,disabled:o||!w,className:"w-full",isLoading:o,children:o?"Connecting...":"Connect MetaMask"})]}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stacks Recipient Address"}),n.jsx("input",{type:"text",value:h,onChange:E=>g(E.target.value),placeholder:"ST1F1M4YP67NV360FBYR28V7C599AC46F8C4635SH",className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none ${h&&!C(h)?"border-red-300 bg-red-50":"border-gray-300"}`}),r&&n.jsx("button",{type:"button",onClick:()=>g(r),className:"mt-1 text-xs text-primary hover:underline",children:"Use connected wallet address"}),h&&!C(h)&&n.jsx("p",{className:"mt-1 text-xs text-red-600",children:"Invalid Stacks address. Must start with ST or SP and be at least 39 characters."}),n.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Enter the Stacks address that will receive the USDCx tokens"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount (USDC)"}),n.jsx("input",{type:"number",step:"0.01",min:"1",value:u,onChange:E=>f(E.target.value),placeholder:"1.00",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none"}),n.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Minimum: 1 USDC (testnet)"})]}),n.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:n.jsxs("p",{className:"text-xs text-blue-800 break-words",children:[n.jsx("strong",{children:"Process:"})," This will approve xReserve to spend your USDC, then initiate the bridge. USDCx will be minted on Stacks in ~15 minutes."]})}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(U,{variant:"primary",onClick:B,disabled:j||!u||!i||!h||!C(h)||!w||!d,isLoading:j,className:"flex-1 min-w-0",children:k?"Approving...":S?"Bridging...":"Bridge USDC"}),n.jsx(U,{variant:"outline",onClick:()=>{N(!1),f(""),g(r||"")},disabled:j,className:"flex-shrink-0",children:"Cancel"})]}),!d&&i&&n.jsx("p",{className:"text-xs text-yellow-600 text-center",children:"Please switch to Sepolia testnet to continue"})]});return e?n.jsxs("div",{children:[n.jsxs("div",{className:"mb-3",children:[n.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Bridge USDC to USDCx"}),n.jsx("p",{className:"text-sm text-gray-600",children:"Bridge USDC from Ethereum Sepolia to USDCx on Stacks testnet"})]}),v]}):n.jsxs(M,{className:"w-full",children:[n.jsxs(L,{children:[n.jsx(O,{children:"Bridge USDC to USDCx"}),n.jsx(V,{children:"Bridge USDC from Ethereum Sepolia to USDCx on Stacks testnet"})]}),n.jsx(R,{children:v})]})}function vt(){const{isConnected:t,connect:e}=te(),[r,s]=x.useState(""),[i]=x.useState(BigInt(1)),{depositRent:a,isPending:o}=Ve(),{balance:l,formatted:c,isLoading:u}=We(),{rentCollected:f}=Le(i),{currentPeriod:h}=Oe(i);x.useEffect(()=>{},[]);const g=async()=>{if(!r||parseFloat(r)<=0){m.error("Please enter a valid amount");return}if(!t){m.error("Please connect your wallet");return}const p=BigInt(Math.floor(parseFloat(r)*1e6));if((l||BigInt(0))<p){m.error(`Insufficient USDCx balance. You have ${c} USDCx but need ${r} USDCx`);return}try{await a(i,r),s("")}catch(k){console.error(k)}},A=r&&parseFloat(r)>0?BigInt(Math.floor(parseFloat(r)*1e6)):BigInt(0),N=l||BigInt(0),$=N<A,d=N===BigInt(0);return t?n.jsx("main",{className:"flex-1 bg-gray-50 relative pattern-dots",children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 relative z-10",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("h1",{className:"text-4xl font-light text-foreground mb-3 tracking-tight",children:"Deposit Rent"}),n.jsx("p",{className:"text-gray-600 font-light text-lg",children:"Record a new rent payment with USDCx"})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[n.jsx("div",{className:"lg:col-span-2",children:n.jsxs(M,{className:"w-full",children:[n.jsxs(L,{children:[n.jsx(O,{children:"Deposit Rent"}),n.jsx(V,{children:"Record a new rent payment with USDCx"})]}),n.jsxs(R,{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Your USDCx Balance"}),n.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-[#06B6D4]/10 rounded-lg p-4 border border-primary/20",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Balance:"}),n.jsx("span",{className:"text-lg font-semibold text-primary",children:u?"Loading...":`${c} USDCx`})]}),d&&!u&&n.jsx("div",{className:"mt-3 pt-3 border-t border-primary/20",children:n.jsxs("p",{className:"text-xs text-gray-600",children:[n.jsx("strong",{children:"No USDCx in wallet."})," You need USDCx tokens to deposit rent."]})})]})]}),d&&!u&&n.jsx("div",{className:"border-t border-gray-200 pt-6",children:n.jsx(pt,{inline:!0})}),n.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount to Deposit (USDCx)"}),n.jsx("input",{type:"number",step:"0.01",value:r,onChange:p=>s(p.target.value),placeholder:"0.00",className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none ${$?"border-red-300 bg-red-50":"border-gray-300"}`}),$&&n.jsxs("p",{className:"mt-1 text-sm text-red-600",children:["Insufficient balance. You need ",r," USDCx but only have ",c," USDCx."]}),n.jsx("div",{className:"mt-4 bg-blue-50 border border-blue-200 rounded-lg p-3",children:n.jsxs("p",{className:"text-xs text-blue-800",children:[n.jsx("strong",{children:"Note:"})," This will transfer USDCx to the rent vault and record the deposit. Make sure you have enough USDCx for the deposit."]})}),n.jsx("div",{className:"mt-4",children:n.jsx(U,{variant:"primary",className:"w-full",onClick:g,isLoading:o,disabled:$||d||!r||parseFloat(r)<=0,children:"Deposit Rent"})})]})]})]})}),n.jsx("div",{children:n.jsxs(M,{className:"w-full",children:[n.jsxs(L,{children:[n.jsx(O,{children:"Payment History"}),n.jsx(V,{children:h!==void 0?`Current Period: ${(h==null?void 0:h.toString())||"0"}`:"Loading..."})]}),n.jsx(R,{children:n.jsxs("div",{className:"space-y-4",children:[h!==void 0&&n.jsx("div",{className:"border-b border-gray-200 pb-4",children:n.jsxs("div",{className:"flex justify-between items-start mb-2",children:[n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-foreground",children:"Current Period"}),n.jsxs("p",{className:"text-sm text-gray-500",children:["Period ",(h==null?void 0:h.toString())||"0"]})]}),n.jsx("p",{className:"font-semibold text-primary",children:f?`${(Number(f)/1e6).toFixed(6)} USDCx`:"0 USDCx"})]})}),h===void 0&&n.jsx("p",{className:"text-gray-500 text-sm",children:"No rent history available"})]})})]})})]})]})}):n.jsx("main",{className:"flex-1 flex items-center justify-center",children:n.jsxs(M,{className:"max-w-md",children:[n.jsxs(L,{children:[n.jsx(O,{children:"Connect Your Wallet"}),n.jsx(V,{children:"Please connect your Stacks wallet to deposit rent"})]}),n.jsx(R,{children:n.jsx(U,{onClick:e,variant:"primary",className:"w-full",children:"Connect Stacks Wallet"})})]})})}export{vt as default};
