import{j as e}from"./web3-vendor-Ds0lPK1P.js";import{r as n}from"./react-vendor-CIGKTyFs.js";import{C as m,a as p,b as x,c as u,d as g}from"./Card-BfqoSBQt.js";import{u as w,B as b,d as P}from"./index-B769BxWL.js";import{z as h}from"./ui-vendor-BDTlLGxs.js";import{u as S}from"./useMounted-Ci4OUALD.js";import{d as k}from"./useStacksWriteWallet-BxURRJTD.js";import{n as A,o as D,q as E}from"./useStacksRead-DDPqlTuW.js";import"./charts-vendor-D_nd7r1X.js";function G(){const{isConnected:a,connect:l}=w(),s=S(),[i]=n.useState(BigInt(1)),[t,c]=n.useState(""),[d,j]=n.useState(""),{createProposal:N,isPending:f}=k(),{proposalCount:o}=A(),y=n.useMemo(()=>{if(!o)return[];const r=Number(o);return Array.from({length:r},(I,C)=>BigInt(C))},[o]),v=async()=>{if(!t||parseFloat(t)<=0){h.error("Please enter a valid amount");return}if(!d.trim()){h.error("Please enter a description");return}if(!a){h.error("Please connect your wallet");return}try{await N(i,t,d),c(""),j("")}catch(r){console.error(r)}};return s?a?e.jsx("main",{className:"flex-1 bg-gray-50 relative pattern-waves",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8 relative z-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-light text-foreground mb-3 tracking-tight",children:"CapEx Governance"}),e.jsx("p",{className:"text-gray-600 font-light text-lg",children:"Create and manage capital expenditure proposals"})]}),e.jsxs(m,{className:"mb-8",children:[e.jsxs(p,{children:[e.jsx(x,{children:"Create New CapEx Proposal"}),e.jsx(u,{children:"Propose a capital expenditure for property improvement"})]}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount (USDCx)"}),e.jsx("input",{type:"number",step:"0.01",value:t,onChange:r=>c(r.target.value),placeholder:"0.00",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:d,onChange:r=>j(r.target.value),placeholder:"Describe the capital expenditure (e.g., Property renovation, HVAC upgrade)",rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none"})]}),e.jsx("div",{className:"bg-primary-light rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-primary-dark",children:[e.jsx("strong",{children:"Note:"})," CapEx affects property value but is excluded from immediate yield distribution, showing long-term value creation."]})}),e.jsx(b,{variant:"primary",className:"w-full",onClick:v,isLoading:f,children:f?"Creating...":"Create Proposal"})]})]}),e.jsxs(m,{children:[e.jsxs(p,{children:[e.jsx(x,{children:"CapEx Proposals"}),e.jsx(u,{children:o!=null?`${o.toString()} proposal(s) total`:"All capital expenditure proposals"})]}),e.jsx(g,{children:e.jsx("div",{className:"space-y-4",children:y.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No proposals created yet. Create one above to get started."}):y.map(r=>e.jsx(B,{proposalId:r},r.toString()))})})]})]})}):e.jsx("main",{className:"flex-1 bg-gray-50",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs(m,{className:"max-w-md mx-auto",children:[e.jsxs(p,{children:[e.jsx(x,{children:"Connect Your Wallet"}),e.jsx(u,{children:"Please connect your wallet to manage CapEx proposals"})]}),e.jsx(g,{children:e.jsx(b,{onClick:l,variant:"primary",className:"w-full",children:"Connect Stacks Wallet"})})]})})}):e.jsx("main",{className:"flex-1 bg-gray-50",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})})})}function B({proposalId:a}){const[l]=n.useState(BigInt(1)),{proposal:s}=D(l,a),{isApproved:i}=E(l,a);if(!s)return null;const t=c=>c?"bg-primary-light text-primary-dark":"bg-yellow-100 text-yellow-800";return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-primary transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("h3",{className:"font-semibold text-foreground",children:["Proposal #",a.toString()]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t(i)}`,children:i?"Approved":"Pending"})]}),e.jsx("p",{className:"text-gray-600 mb-2",children:s.description}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Proposed by ",P(s.proposer)," on"," ",new Date(Number(s.timestamp)*1e3).toLocaleDateString()]})]}),e.jsx("div",{className:"text-right ml-4",children:e.jsx("p",{className:"text-2xl font-bold text-foreground",children:s.amount?`${(Number(s.amount)/1e6).toFixed(6)} USDCx`:"0 USDCx"})})]})})}export{G as default};
