import{u as S,j as e}from"./web3-vendor-D_2QueDk.js";import{r as g}from"./react-vendor-CRkQyOmC.js";import{C as l,a as i,b as c,c as d,d as u}from"./Card-CAjATs8d.js";import{B as N,b as z,f as B}from"./index-DtViDtG1.js";import{z as o}from"./ui-vendor-uCQPwa67.js";import{u as L}from"./useMounted-ByB6DgmY.js";import{g as F,h as R}from"./useContractWrite-BRNpROzc.js";import{u as M,a as O,b as T}from"./useDAO-DHvvARgt.js";import"./charts-vendor-CrfDGR6m.js";function K(){const{isConnected:a}=S(),j=L(),[n,t]=g.useState(""),[p,x]=g.useState(""),{createProposal:C,isPending:f,isConfirming:v,isConfirmed:y}=F(),{approveProposal:P,isPending:w,isConfirming:A,isConfirmed:b}=R(),{proposalCount:r}=M(),h=g.useMemo(()=>{if(!r)return[];const s=Number(r);return Array.from({length:s},(m,E)=>BigInt(E))},[r]);g.useEffect(()=>{y&&(o.success("Proposal created successfully!"),t(""),x(""))},[y]),g.useEffect(()=>{b&&o.success("Proposal approved!")},[b]);const k=async()=>{if(!n||parseFloat(n)<=0){o.error("Please enter a valid amount");return}if(!p.trim()){o.error("Please enter a description");return}if(!a){o.error("Please connect your wallet");return}try{await C(n,p)}catch(s){o.error((s==null?void 0:s.message)||"Failed to create proposal"),console.error(s)}},D=async s=>{if(!a){o.error("Please connect your wallet");return}try{await P(s)}catch(m){o.error((m==null?void 0:m.message)||"Failed to approve proposal"),console.error(m)}};return j?a?e.jsxs("main",{className:"flex-1 bg-gray-50 relative pattern-waves",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-[#06B6D4]/5"}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8 relative z-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-light text-foreground mb-3 tracking-tight",children:"DAO Governance"}),e.jsx("p",{className:"text-gray-600 font-light text-lg",children:"Create and vote on CapEx proposals"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsx(c,{className:"text-lg",children:"Total Proposals"}),e.jsx(d,{children:"All time"})]}),e.jsx(u,{children:e.jsx("p",{className:"text-3xl font-bold text-foreground",children:r!=null?r.toString():"0"})})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsx(c,{className:"text-lg",children:"Pending Proposals"}),e.jsx(d,{children:"Awaiting approval"})]}),e.jsx(u,{children:e.jsx("p",{className:"text-3xl font-bold text-primary",children:h.length>0?"Check below":"0"})})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsx(c,{className:"text-lg",children:"Approved Proposals"}),e.jsx(d,{children:"Approved"})]}),e.jsx(u,{children:e.jsx("p",{className:"text-3xl font-bold text-primary",children:h.length>0?"Check below":"0"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsx(c,{children:"Create New Proposal"}),e.jsx(d,{children:"Propose a new CapEx expenditure"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount (USDC)"}),e.jsx("input",{type:"number",step:"0.01",value:n,onChange:s=>t(s.target.value),placeholder:"0.00",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:p,onChange:s=>x(s.target.value),placeholder:"e.g., Roof replacement and repair",rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none resize-none"})]}),e.jsx("div",{className:"bg-primary-light rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-primary-dark",children:[e.jsx("strong",{children:"Note:"})," Proposals require approval from authorized signers before execution. In production, this would use token-weighted voting."]})}),e.jsx(N,{variant:"primary",className:"w-full",onClick:k,isLoading:f||v,children:f||v?"Creating...":"Create Proposal"})]})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsx(c,{children:"Active Proposals"}),e.jsx(d,{children:r!=null?`${r.toString()} proposal(s) total`:"Recent CapEx proposals"})]}),e.jsx(u,{children:e.jsx("div",{className:"space-y-4 max-h-[600px] overflow-y-auto",children:h.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No proposals created yet. Create one above to get started."}):h.map(s=>e.jsx(q,{proposalId:s,onApprove:D,isApproving:w||A},s.toString()))})})]})]})]})]}):e.jsx("main",{className:"flex-1 bg-gray-50",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx(l,{className:"max-w-md mx-auto",children:e.jsxs(i,{children:[e.jsx(c,{children:"Connect Your Wallet"}),e.jsx(d,{children:"Please connect your wallet to participate in governance"})]})})})}):e.jsx("main",{className:"flex-1 bg-gray-50",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})})})}function q({proposalId:a,onApprove:j,isApproving:n}){const{proposal:t,isLoading:p}=O(a),{isApproved:x}=T(a);return p?e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]})}):t?e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-primary/50 transition-material",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("h3",{className:"font-medium text-foreground",children:["Proposal #",a.toString()]}),x?e.jsx("span",{className:"px-2 py-1 bg-primary/10 text-primary text-xs font-medium rounded-full",children:"Approved"}):e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs font-medium rounded-full",children:"Pending"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("span",{children:["Proposer: ",z(t.proposer)]}),e.jsx("span",{children:new Date(Number(t.timestamp)*1e3).toLocaleDateString()})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-semibold text-primary text-lg",children:B(t.amount)})})]}),!x&&e.jsx(N,{variant:"outline",size:"sm",className:"w-full mt-3",onClick:()=>j(a),isLoading:n,children:n?"Approving...":"Approve Proposal"})]}):null}export{K as default};
