import{j as e}from"./web3-vendor-Ds0lPK1P.js";import{r as u}from"./react-vendor-CIGKTyFs.js";import{C as o,a as n,b as i,c,d}from"./Card-DWvOJBa6.js";import{u as k,B as f,d as D}from"./index-DrNp6A46.js";import{z as h}from"./ui-vendor-BDTlLGxs.js";import{u as z}from"./useMounted-Ci4OUALD.js";import{d as E,e as B}from"./useStacksWriteWallet-DpzWZPfV.js";import{n as V,o as F,q as W}from"./useStacksRead-BF2QryqZ.js";import"./charts-vendor-D_nd7r1X.js";function H(){const{isConnected:t,connect:m}=k(),g=z(),[l]=u.useState(BigInt(1)),[r,x]=u.useState(""),[j,y]=u.useState(""),{createProposal:b,isPending:N}=E(),{voteFor:C,isPending:P}=B(),{proposalCount:a}=V(),p=u.useMemo(()=>{if(!a)return[];const s=Number(a);return Array.from({length:s},(v,S)=>BigInt(S))},[a]),w=async()=>{if(!r||parseFloat(r)<=0){h.error("Please enter a valid amount");return}if(!j.trim()){h.error("Please enter a description");return}if(!t){h.error("Please connect your wallet");return}try{await b(l,r,j),x(""),y("")}catch(s){console.error(s)}},A=async s=>{if(!t){h.error("Please connect your wallet");return}try{await C(l,s)}catch(v){console.error(v)}};return g?t?e.jsxs("main",{className:"flex-1 bg-gray-50 relative pattern-waves",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-[#06B6D4]/5"}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8 relative z-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-light text-foreground mb-3 tracking-tight",children:"DAO Governance"}),e.jsx("p",{className:"text-gray-600 font-light text-lg",children:"Create and vote on CapEx proposals"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs(o,{children:[e.jsxs(n,{children:[e.jsx(i,{className:"text-lg",children:"Total Proposals"}),e.jsx(c,{children:"All time"})]}),e.jsx(d,{children:e.jsx("p",{className:"text-3xl font-bold text-foreground",children:a!=null?a.toString():"0"})})]}),e.jsxs(o,{children:[e.jsxs(n,{children:[e.jsx(i,{className:"text-lg",children:"Pending Proposals"}),e.jsx(c,{children:"Awaiting approval"})]}),e.jsx(d,{children:e.jsx("p",{className:"text-3xl font-bold text-primary",children:p.length>0?"Check below":"0"})})]}),e.jsxs(o,{children:[e.jsxs(n,{children:[e.jsx(i,{className:"text-lg",children:"Approved Proposals"}),e.jsx(c,{children:"Approved"})]}),e.jsx(d,{children:e.jsx("p",{className:"text-3xl font-bold text-primary",children:p.length>0?"Check below":"0"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(o,{children:[e.jsxs(n,{children:[e.jsx(i,{children:"Create New Proposal"}),e.jsx(c,{children:"Propose a new CapEx expenditure"})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount (USDCx)"}),e.jsx("input",{type:"number",step:"0.01",value:r,onChange:s=>x(s.target.value),placeholder:"0.00",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:j,onChange:s=>y(s.target.value),placeholder:"e.g., Roof replacement and repair",rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none resize-none"})]}),e.jsx("div",{className:"bg-primary-light rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-primary-dark",children:[e.jsx("strong",{children:"Note:"})," Proposals require approval from authorized signers before execution. In production, this would use token-weighted voting."]})}),e.jsx(f,{variant:"primary",className:"w-full",onClick:w,isLoading:N,children:N?"Creating...":"Create Proposal"})]})]}),e.jsxs(o,{children:[e.jsxs(n,{children:[e.jsx(i,{children:"Active Proposals"}),e.jsx(c,{children:a!=null?`${a.toString()} proposal(s) total`:"Recent CapEx proposals"})]}),e.jsx(d,{children:e.jsx("div",{className:"space-y-4 max-h-[600px] overflow-y-auto",children:p.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No proposals created yet. Create one above to get started."}):p.map(s=>e.jsx(L,{proposalId:s,propertyId:l,onVote:A,isVoting:P},s.toString()))})})]})]})]})]}):e.jsx("main",{className:"flex-1 bg-gray-50",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs(o,{className:"max-w-md mx-auto",children:[e.jsxs(n,{children:[e.jsx(i,{children:"Connect Your Wallet"}),e.jsx(c,{children:"Please connect your wallet to participate in governance"})]}),e.jsx(d,{children:e.jsx(f,{onClick:m,variant:"primary",className:"w-full",children:"Connect Stacks Wallet"})})]})})}):e.jsx("main",{className:"flex-1 bg-gray-50",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})})})}function L({proposalId:t,propertyId:m,onVote:g,isVoting:l}){const{proposal:r}=F(m,t),{isApproved:x}=W(m,t);return r?e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-primary/50 transition-material",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("h3",{className:"font-medium text-foreground",children:["Proposal #",t.toString()]}),x?e.jsx("span",{className:"px-2 py-1 bg-primary/10 text-primary text-xs font-medium rounded-full",children:"Approved"}):e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs font-medium rounded-full",children:"Pending"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:r.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("span",{children:["Proposer: ",D(r.proposer)]}),e.jsx("span",{children:new Date(Number(r.timestamp)*1e3).toLocaleDateString()})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-semibold text-primary text-lg",children:r.amount?`${(Number(r.amount)/1e6).toFixed(6)} USDCx`:"0 USDCx"})})]}),!x&&e.jsx(f,{variant:"outline",size:"sm",className:"w-full mt-3",onClick:()=>g(t),isLoading:l,children:l?"Voting...":"Vote For Proposal"})]}):null}export{H as default};
