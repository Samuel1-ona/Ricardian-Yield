import{u as j,e as R,p as w,j as e}from"./web3-vendor-D_2QueDk.js";import{r as S}from"./react-vendor-CRkQyOmC.js";import{C as h,a as f,b as g,c as y,d as U}from"./Card-CAjATs8d.js";import{C as p,f as o,B as T}from"./index-DtViDtG1.js";import{z as l}from"./ui-vendor-uCQPwa67.js";import{u as L,a as k}from"./useContractWrite-BRNpROzc.js";import{u as I,a as Y}from"./useCashFlow-D3VL_ORA.js";import"./charts-vendor-CrfDGR6m.js";const P=[{name:"balanceOf",type:"function",stateMutability:"view",inputs:[{name:"account",type:"address"}],outputs:[{name:"",type:"uint256"}]},{name:"allowance",type:"function",stateMutability:"view",inputs:[{name:"owner",type:"address"},{name:"spender",type:"address"}],outputs:[{name:"",type:"uint256"}]},{name:"decimals",type:"function",stateMutability:"view",inputs:[],outputs:[{name:"",type:"uint8"}]}];function F(){const{address:t}=j(),{data:s,isLoading:n,error:c}=R({address:p.USDC,abi:P,functionName:"balanceOf",args:t?[t]:void 0,query:{enabled:!!t}});return{balance:s,isLoading:n,error:c}}function M(){const{address:t}=j(),{data:s,isLoading:n,error:c}=R({address:p.USDC,abi:P,functionName:"allowance",args:t&&p.RENT_VAULT?[t,p.RENT_VAULT]:void 0,query:{enabled:!!t}});return{allowance:s,isLoading:n,error:c}}function G(){const{isConnected:t}=j(),[s,n]=S.useState(""),{depositRent:c,isPending:B,isConfirmed:b}=L(),{approveUSDC:A}=k(),{allowance:N}=M(),{balance:m}=F(),{rentCollected:C}=I(),{currentPeriod:a}=Y();S.useEffect(()=>{b&&(l.success("Rent deposited successfully!"),n(""))},[b]);const E=async()=>{if(!s||parseFloat(s)<=0){l.error("Please enter a valid amount");return}if(!t){l.error("Please connect your wallet");return}const r=w(s,6),u=m;if(!u||u<r){l.error(`Insufficient USDC balance. You have ${u?o(u):"0 USDC"} but need ${o(r)}`);return}try{(!N||N<r)&&(await A(r),l.success("USDC approved! Now depositing rent..."),await new Promise(i=>setTimeout(i,2e3))),await c(s)}catch(i){l.error((i==null?void 0:i.message)||"Failed to deposit rent"),console.error(i)}},v=s&&parseFloat(s)>0?w(s,6):BigInt(0),d=m,x=d!==void 0&&v>d,D=d===void 0||d===BigInt(0);return t?e.jsx("main",{className:"flex-1 bg-gray-50 relative pattern-dots",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 relative z-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-light text-foreground mb-3 tracking-tight",children:"Deposit Rent"}),e.jsx("p",{className:"text-gray-600 font-light text-lg",children:"Record a new rent payment"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(h,{children:[e.jsxs(f,{children:[e.jsx(g,{children:"New Rent Payment"}),e.jsx(y,{children:"Enter the rent amount in USDC"})]}),e.jsxs(U,{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-[#06B6D4]/10 rounded-lg p-4 border border-primary/20",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Your USDC Balance:"}),e.jsx("span",{className:"text-lg font-semibold text-primary",children:m!==void 0?o(m):"Loading..."})]}),D&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-primary/20",children:[e.jsxs("p",{className:"text-xs text-gray-600 mb-2",children:[e.jsx("strong",{children:"No USDC in wallet."})," You need USDC tokens to deposit rent."]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Get testnet USDC from Mantle Sepolia faucets or bridges."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount (USDC)"}),e.jsx("input",{type:"number",step:"0.01",value:s,onChange:r=>n(r.target.value),placeholder:"0.00",className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none ${x?"border-red-300 bg-red-50":"border-gray-300"}`}),x&&e.jsxs("p",{className:"mt-1 text-sm text-red-600",children:["Insufficient balance. You need ",o(v)," but only have ",o(d),"."]})]}),e.jsx("div",{className:"bg-primary-light rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-primary-dark",children:[e.jsx("strong",{children:"Note:"})," You'll need to approve USDC spending first, then deposit the rent. The system will automatically stack idle funds into DeFi vaults."]})}),e.jsx("div",{className:"flex gap-4",children:e.jsx(T,{variant:"primary",className:"flex-1",onClick:E,isLoading:B,disabled:x||D||!s||parseFloat(s)<=0,children:"Deposit Rent"})})]})]})}),e.jsx("div",{children:e.jsxs(h,{children:[e.jsxs(f,{children:[e.jsx(g,{children:"Payment History"}),e.jsx(y,{children:a!==void 0?`Current Period: ${a!==null?a.toString():""}`:"Loading..."})]}),e.jsx(U,{children:e.jsxs("div",{className:"space-y-4",children:[a!==void 0&&e.jsx("div",{className:"border-b border-gray-200 pb-4",children:e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Current Period"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Period ",a!==null?a.toString():""]})]}),e.jsx("p",{className:"font-semibold text-primary",children:C?o(C):"0 USDC"})]})}),a===void 0&&e.jsx("p",{className:"text-gray-500 text-sm",children:"No rent history available"})]})})]})})]})]})}):e.jsx("main",{className:"flex-1 flex items-center justify-center",children:e.jsx(h,{className:"max-w-md",children:e.jsxs(f,{children:[e.jsx(g,{children:"Connect Your Wallet"}),e.jsx(y,{children:"Please connect your wallet to deposit rent"})]})})})}export{G as default};
