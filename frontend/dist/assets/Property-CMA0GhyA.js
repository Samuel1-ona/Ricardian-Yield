import{j as e}from"./web3-vendor-Ds0lPK1P.js";import{r as h}from"./react-vendor-CIGKTyFs.js";import{C as d,d as u,a as m,b as p,c as b}from"./Card-BfqoSBQt.js";import{B as C,u as E}from"./index-B769BxWL.js";import{u as M}from"./useMounted-Ci4OUALD.js";import{c as $,d as L,e as O,u as z,f as T,g as V,a as W,h as q}from"./useStacksRead-DDPqlTuW.js";import{u as A}from"./useStacksWriteWallet-BxURRJTD.js";import{z as I}from"./ui-vendor-BDTlLGxs.js";import"./charts-vendor-D_nd7r1X.js";function Y({onMinted:l}){const{mintProperty:i,isPending:x}=A(),[s,g]=h.useState(""),[c,o]=h.useState(""),[r,j]=h.useState(""),[v,f]=h.useState(""),[w,N]=h.useState(!1),S=async()=>{if(!s.trim()){I.error("Please enter a location");return}if(!c||parseFloat(c)<=0){I.error("Please enter a valid valuation");return}if(!r||parseFloat(r)<=0){I.error("Please enter a valid monthly rent");return}try{await i(s,c,r,v),g(""),o(""),j(""),f(""),N(!1),l==null||l()}catch(t){console.error(t)}};return w?e.jsxs(d,{children:[e.jsxs(m,{children:[e.jsx(p,{children:"Mint New Property NFT"}),e.jsx(b,{children:"Create a new tokenized property"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Location *"}),e.jsx("input",{type:"text",value:s,onChange:t=>g(t.target.value),placeholder:"123 Main St, San Francisco, CA",maxLength:200,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valuation (USDCx) *"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:c,onChange:t=>o(t.target.value),placeholder:"1000000.00",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Total property value in USDCx"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Monthly Rent (USDCx) *"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:r,onChange:t=>j(t.target.value),placeholder:"10000.00",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Expected monthly rental income in USDCx"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Metadata URI (optional)"}),e.jsx("input",{type:"text",value:v,onChange:t=>f(t.target.value),placeholder:"https://example.com/metadata.json",maxLength:200,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Link to property metadata (JSON, image, etc.)"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-blue-800",children:[e.jsx("strong",{children:"Note:"})," Only the contract owner can mint properties. Make sure you're connected with the owner wallet."]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{variant:"primary",onClick:S,disabled:x||!s||!c||!r,isLoading:x,className:"flex-1",children:x?"Minting...":"Mint Property"}),e.jsx(C,{variant:"outline",onClick:()=>{N(!1),g(""),o(""),j(""),f("")},disabled:x,children:"Cancel"})]})]})]}):e.jsx(d,{className:"border-2 border-dashed border-primary/30",children:e.jsx(u,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"No properties found. Mint a new property NFT to get started."}),e.jsx(C,{variant:"primary",onClick:()=>N(!0),children:"Mint New Property"})]})})})}function k(l){if(!l)return null;if(typeof l=="string"||typeof l=="number")return l;if(typeof l=="object"){if("value"in l){const i=l.value;if(typeof i=="string"||typeof i=="number")return i;if(typeof i=="object"&&"value"in i)return k(i)}if("repr"in l){const i=l.repr;if(typeof i=="string"){const x=i.match(/u?(\d+)/);if(x)return x[1]}}}return null}function te(){const{isConnected:l,connect:i}=E(),x=M(),[s,g]=h.useState(null),{lastTokenId:c}=$(),o=h.useMemo(()=>{if(!c||c===BigInt(0))return[];const a=[];for(let y=BigInt(1);y<=c;y++)a.push(y);return a},[c]);h.useMemo(()=>{o.length>0&&s===null&&g(o[0])},[o,s]);const{propertyData:r}=L(s||void 0),{owner:j}=O(s||void 0),{rentCollected:v}=z(s||void 0),{operatingExpenses:f}=T(s||void 0),{workingCapitalReserve:w}=V(s||void 0),{distributableCashFlow:N}=W(s||void 0),{capexSpent:S}=q(s||void 0),t=h.useMemo(()=>{var R,U,P;if(!r||!s)return null;let a="",y=null,D=null;(R=r.value)!=null&&R.location?a=r.value.location:r.location?a=r.location:typeof r=="object"&&"location"in r&&(a=String(r.location||""));const B=k(((U=r.value)==null?void 0:U.valuation)||r.valuation);B&&(y=BigInt(B));const F=k(((P=r.value)==null?void 0:P.monthlyRent)||r["monthly-rent"]||r.monthlyRent);return F&&(D=BigInt(F)),{location:a||"Unknown Location",valuation:y||BigInt(0),monthlyRent:D||BigInt(0),propertyId:Number(s),owner:j||""}},[r,s,j]),n={totalRentCollected:v||BigInt(0),operatingExpenses:f||BigInt(0),workingCapitalReserve:w||BigInt(0),capexSpent:S||BigInt(0),distributableCashFlow:N||BigInt(0)};return x?l?o.length===0?e.jsx("main",{className:"flex-1 bg-gray-50 relative pattern-dots",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 relative z-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-light text-foreground mb-3 tracking-tight",children:"Property Overview"}),e.jsx("p",{className:"text-gray-600 font-light text-lg",children:"Create and manage tokenized properties"})]}),e.jsx(Y,{onMinted:()=>window.location.reload()})]})}):!s||!t?e.jsx("main",{className:"flex-1 bg-gray-50 relative pattern-dots",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 relative z-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-light text-foreground mb-3 tracking-tight",children:"Properties"}),e.jsx("p",{className:"text-gray-600 font-light text-lg",children:"Select a property to view details"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(a=>e.jsx(d,{className:"cursor-pointer hover:border-primary transition-colors",onClick:()=>g(a),children:e.jsxs(m,{children:[e.jsxs(p,{children:["Property #",a.toString()]}),e.jsx(b,{children:"Click to view details"})]})},a.toString()))})]})}):e.jsxs("main",{className:"flex-1 bg-gray-50 relative pattern-dots",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-primary/10 to-[#06B6D4]/10 rounded-full blur-3xl"}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 relative z-10",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-light text-foreground mb-3 tracking-tight",children:"Property Overview"}),e.jsx("p",{className:"text-gray-600 font-light text-lg",children:"Detailed view of your tokenized property"})]}),o.length>1&&e.jsx("div",{className:"flex gap-2",children:e.jsx("select",{value:s.toString(),onChange:a=>g(BigInt(a.target.value)),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none",children:o.map(a=>e.jsxs("option",{value:a.toString(),children:["Property #",a.toString()]},a.toString()))})})]})}),e.jsxs(d,{className:"mb-8",children:[e.jsxs(m,{children:[e.jsx(p,{className:"text-2xl",children:t.location}),e.jsxs(b,{children:["Property ID: ",t.propertyId,t.owner&&` â€¢ Owner: ${t.owner.slice(0,6)}...${t.owner.slice(-4)}`]})]}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Valuation"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:t.valuation>BigInt(0)?`${(Number(t.valuation)/1e6).toFixed(2)} USDCx`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Monthly Rent"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:t.monthlyRent>BigInt(0)?`${(Number(t.monthlyRent)/1e6).toFixed(6)} USDCx`:"0 USDCx"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Annual Yield"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[t.valuation>BigInt(0)&&t.monthlyRent>BigInt(0)?(Number(t.monthlyRent)*12/Number(t.valuation)*100).toFixed(2):"0","%"]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(p,{className:"text-lg",children:"Rent Collected"})}),e.jsx(u,{children:e.jsx("p",{className:"text-3xl font-bold text-primary",children:n.totalRentCollected>BigInt(0)?`${(Number(n.totalRentCollected)/1e6).toFixed(6)} USDCx`:"0 USDCx"})})]}),e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(p,{className:"text-lg",children:"Operating Expenses"})}),e.jsx(u,{children:e.jsx("p",{className:"text-3xl font-bold text-red-500",children:n.operatingExpenses>BigInt(0)?`${(Number(n.operatingExpenses)/1e6).toFixed(6)} USDCx`:"0 USDCx"})})]}),e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(p,{className:"text-lg",children:"Distributable Cash Flow"})}),e.jsx(u,{children:e.jsx("p",{className:"text-3xl font-bold text-primary",children:n.distributableCashFlow>BigInt(0)?`${(Number(n.distributableCashFlow)/1e6).toFixed(6)} USDCx`:"0 USDCx"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(d,{children:[e.jsxs(m,{children:[e.jsx(p,{children:"Cash Flow Breakdown"}),e.jsx(b,{children:"Income and expenses breakdown"})]}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Rent Collected"}),e.jsx("span",{className:"font-semibold text-foreground",children:n.totalRentCollected>BigInt(0)?`${(Number(n.totalRentCollected)/1e6).toFixed(6)} USDCx`:"0 USDCx"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Operating Expenses"}),e.jsxs("span",{className:"font-semibold text-red-500",children:["-",n.operatingExpenses>BigInt(0)?`${(Number(n.operatingExpenses)/1e6).toFixed(6)} USDCx`:"0 USDCx"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Working Capital Reserve"}),e.jsxs("span",{className:"font-semibold text-gray-500",children:["-",n.workingCapitalReserve>BigInt(0)?`${(Number(n.workingCapitalReserve)/1e6).toFixed(6)} USDCx`:"0 USDCx"]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold text-foreground",children:"Distributable Cash Flow"}),e.jsx("span",{className:"font-bold text-primary text-xl",children:n.distributableCashFlow>BigInt(0)?`${(Number(n.distributableCashFlow)/1e6).toFixed(6)} USDCx`:"0 USDCx"})]})]})})]}),e.jsxs(d,{children:[e.jsxs(m,{children:[e.jsx(p,{children:"Capital Expenditures"}),e.jsx(b,{children:"Long-term value creation"})]}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Total CapEx Spent"}),e.jsx("span",{className:"font-semibold text-foreground",children:n.capexSpent>BigInt(0)?`${(Number(n.capexSpent)/1e6).toFixed(6)} USDCx`:"0 USDCx"})]}),e.jsx("div",{className:"bg-primary-light rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-primary-dark",children:"CapEx affects property value but is excluded from immediate yield distribution, showing long-term value creation."})})]})})]})]})]})]}):e.jsx("main",{className:"flex-1 bg-gray-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs(d,{className:"max-w-md mx-auto",children:[e.jsxs(m,{children:[e.jsx(p,{children:"Connect Your Wallet"}),e.jsx(b,{children:"Please connect your wallet to view property details"})]}),e.jsx(u,{children:e.jsx(C,{onClick:i,variant:"primary",className:"w-full",children:"Connect Stacks Wallet"})})]})})}):e.jsx("main",{className:"flex-1 bg-gray-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})})})}export{te as default};
